<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ITST ‚Äì 5¬™ ¬∑ Lez2_5 ¬∑ Attributi derivati, multivalore e composti</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../default.css" />
  <script src="../highlight.js"></script>
  <script>
    try { hljs.highlightAll(); } catch (e) {}
    function prevSlide(){ window.location.href = "lez2_4.html"; }
    function nextSlide(){ window.location.href = "lez2_6.html"; }
    function toggleMenu(){ document.getElementById('menu').classList.toggle('open'); }
    function toggleBox(btnId, boxId){
      const box = document.getElementById(boxId);
      const btn = document.getElementById(btnId);
      const open = box.style.display === 'block';
      box.style.display = open ? 'none' : 'block';
      btn.textContent = open ? 'Mostra ‚ñº' : 'Nascondi ‚ñ≤';
    }
  </script>
</head>
<body>
  <!-- BEGIN MENU -->
  <button class="menu-toggle" onclick="toggleMenu()">&#9776; Menu</button>
  <div class="sidebar" id="menu">
    <h2>Lezione 2 ‚Äî Diagramma E-R di Chen</h2>
    <ul>
      <li><a href="lez2_1.html">Lez2.1: Introduzione e motivazioni</a></li>
      <li><a href="lez2_2.html">Lez2.2: Concetti fondamentali</a></li>
      <li><a href="lez2_3.html">Lez2.3: Relazioni e cardinalit√†</a></li>
      <li><a href="lez2_4.html">Lez2.4: Entit√† deboli e identificazione</a></li>
      <li><a href="lez2_5.html">Lez2.5: Attributi derivati e composti</a></li>
      <li><a href="lez2_6.html">Lez2.6: Generalizzazione e specializzazione</a></li>
      <li><a href="lez2_7.html">Lez2.7: Traduzione E-R ‚Üí Relazionale</a></li>
      <li><a href="lez2_8.html">Lez2.8: Esercitazione e micro-verifica</a></li>
    </ul>
  </div>
  <!-- END MENU -->

  <div class="slide">
    <h1>Attributi derivati, multivalore e composti</h1>

    <div class="nav-buttons" style="margin-bottom:10px">
      <button onclick="prevSlide()">&#8592; Indietro</button>
      <button onclick="nextSlide()">Avanti &#8594;</button>
    </div>

    <div class="content-box">
      <div class="inner-box">

        <h2>Definizioni formali</h2>
        <div class="box">
          <ul>
            <li><strong>Attributo (semplice)</strong>: funzione <code>f<sub>A</sub> : E ‚Üí Dom(A)</code> che associa a ogni istanza dell‚Äôentit√† <code>E</code> un valore nel dominio <code>Dom(A)</code>. Se opzionale: funzione parziale.</li>
            <li><strong>Attributo composto</strong>: funzione <code>f<sub>C</sub> : E ‚Üí Dom(A‚ÇÅ) √ó ‚Ä¶ √ó Dom(A‚Çñ)</code>. I componenti <code>A‚ÇÅ,‚Ä¶,A‚Çñ</code> sono attributi semplici collegati all‚Äôovale ‚Äúpadre‚Äù.</li>
            <li><strong>Attributo multivalore</strong>: funzione a valori-insieme <code>f<sub>M</sub> : E ‚Üí ùí´(Dom(A))</code> (sottoinsiemi del dominio). L‚Äôordine non conta; le ripetizioni non hanno senso.</li>
            <li><strong>Attributo derivato</strong>: definito da un‚Äôespressione <code>g</code> sugli altri attributi/relazioni: <code>f<sub>D</sub>(e) = g(f<sub>A</sub>(e), ‚Ä¶)</code>. √à <em>logicamente determinato</em>, di norma non memorizzato.</li>
          </ul>
        </div>

        <h2>Notazione grafica (Chen)</h2>
        <div class="box">
          <ul>
            <li>Attributo semplice: <strong>ovale singolo</strong>.</li>
            <li>Attributo composto: ovale ‚Äúpadre‚Äù collegato a sotto-ovali.</li>
            <li>Attributo multivalore: <strong>ovale doppio</strong>.</li>
            <li>Attributo derivato: ovale <strong>tratteggiato</strong>.</li>
          </ul>

<!-- SVG RESPONSIVA E CON MARGINI AMPI (CONNESSIONI PRECISISSIME SUGLI OVALI) -->
<svg viewBox="0 0 820 300" width="100%" height="320" preserveAspectRatio="xMidYMid meet" style="display:block;margin:0 auto">
  <!-- Entit√† centrale -->
  <rect x="350" y="120" width="120" height="50" rx="8" ry="8"
        fill="#f0f9ff" stroke="#2563eb" stroke-width="2"/>
  <text x="410" y="148" font-size="15" text-anchor="middle" fill="#1e3a8a">STUDENTE</text>

  <!-- Attributo composto: Indirizzo (ovale padre) -->
  <ellipse cx="180" cy="70" rx="75" ry="28"
           fill="#ffffff" stroke="#16a34a" stroke-width="2"/>
  <text x="180" y="75" text-anchor="middle" font-size="13" fill="#166534">Indirizzo</text>

  <!-- Sotto-attributi di Indirizzo -->
  <ellipse cx="110" cy="140" rx="55" ry="22"
           fill="#ecfdf5" stroke="#16a34a" stroke-width="2"/>
  <text x="110" y="144" text-anchor="middle" font-size="12" fill="#166534">Via</text>

  <ellipse cx="180" cy="175" rx="55" ry="22"
           fill="#ecfdf5" stroke="#16a34a" stroke-width="2"/>
  <text x="180" y="179" text-anchor="middle" font-size="12" fill="#166534">Citt√†</text>

  <ellipse cx="250" cy="140" rx="55" ry="22"
           fill="#ecfdf5" stroke="#16a34a" stroke-width="2"/>
  <text x="250" y="144" text-anchor="middle" font-size="12" fill="#166534">CAP</text>

  <!-- Attributo multivalore: Telefono (ovale doppio) -->
  <ellipse cx="640" cy="70" rx="75" ry="28"
           fill="#ffffff" stroke="#16a34a" stroke-width="2"/>
  <ellipse cx="640" cy="70" rx="83" ry="36"
           fill="none" stroke="#16a34a" stroke-width="2"/>
  <text x="640" y="75" text-anchor="middle" font-size="13" fill="#166534">Telefono</text>

  <!-- Attributo derivato: Et√† (tratteggiato) -->
  <ellipse cx="640" cy="230" rx="62" ry="24"
           fill="#ffffff" stroke="#16a34a" stroke-width="2" stroke-dasharray="5,3"/>
  <text x="640" y="235" text-anchor="middle" font-size="13" fill="#166534">Et√†</text>

  <!-- Collegamenti: entit√† -> attributi principali (puntano al BORDO degli ovali) -->
  <!-- Verso Indirizzo -->
  <line x1="350" y1="145" x2="228.448" y2="91.374" stroke="#2563eb" stroke-width="2"/>
  <!-- Verso Telefono (inner oval) -->
  <line x1="470" y1="145" x2="591.552" y2="91.374" stroke="#2563eb" stroke-width="2"/>
  <!-- Verso Et√† -->
  <line x1="470" y1="145" x2="602.045" y2="211.023" stroke="#2563eb" stroke-width="2"/>

  <!-- Collegamenti: Indirizzo (padre) -> sotto-attributi (bordo‚Üíbordo, no sovrapposizioni) -->
  <!-- Indirizzo ‚Üí Via -->
  <line x1="153.768" y1="96.232" x2="130.426" y2="119.574" stroke="#2563eb" stroke-width="2"/>
  <!-- Indirizzo ‚Üí Citt√† -->
  <line x1="180.000" y1="98.000" x2="180.000" y2="153.000" stroke="#2563eb" stroke-width="2"/>
  <!-- Indirizzo ‚Üí CAP -->
  <line x1="206.232" y1="96.232" x2="229.574" y2="119.574" stroke="#2563eb" stroke-width="2"/>
</svg>

          <p class="note">Layout centrato, con margini adeguati: niente tagli n√© sovrapposizioni anche su schermi stretti.</p>
        </div>

        <h2>Esempi e formalizzazione</h2>
        <div class="box">
          <pre><code class="language-text">Entit√† STUDENTE(Matr, Nome, Cognome, DataNascita, Indirizzo, Telefono*)
Dove:
  Indirizzo = (Via, Citt√†, CAP)         ‚Üê attributo composto
  Telefono*  = insieme di valori        ‚Üê attributo multivalore
  Et√†        = oggi ‚àí DataNascita       ‚Üê attributo derivato (non memorizzato)

Funzioni:
  f_Via : STUDENTE ‚Üí STRING
  f_Citt√† : STUDENTE ‚Üí STRING
  f_CAP : STUDENTE ‚Üí STRING
  f_Telefono : STUDENTE ‚Üí ùí´(STRING)
  f_Et√† : STUDENTE ‚Üí N (definita come g(DataNascita, data_corrente))
          </code></pre>
          <ul>
            <li><strong>Semantica del multivalore</strong>: <code>f_Telefono(e)</code> √® un insieme; non si rappresenta con liste separate da virgole.</li>
            <li><strong>Semantica del derivato</strong>: <code>Et√†</code> dipende dal tempo; memorizzarla pu√≤ generare inconsistenze.</li>
          </ul>
        </div>


<h2>Vincoli e buone pratiche</h2>
<div class="box">
  <ul>
    <li>
      <strong>Dominio e validazione</strong>:
      <ul>
        <li><em>Dominio</em> = insieme dei valori ammessi per un attributo. Deve essere espresso come <strong>predicato</strong> chiaro (vero/falso) e non come descrizione vaga.</li>
        <li>Esempi di predicati:
          <ul>
            <li><code>CAP ‚àà {00000‚Ä¶99999}</code> con lunghezza esattamente 5 (zero iniziali ammessi).</li>
            <li><code>Email</code>: contiene ‚Äú@‚Äù e non inizia/termina con ‚Äú@‚Äù.</li>
            <li><code>Telefono</code>: cifre + opzionale ‚Äú+‚Äù iniziale; spazi e trattini normalizzati prima del controllo.</li>
          </ul>
        </li>
        <li><em>Normalizzazione del formato</em> prima della validazione (spazi, maiuscole/minuscole, accenti) per evitare falsi negativi/duplicati semantici.</li>
        <li>Scrivi sempre il vincolo come formula: <code>‚àÄ e ‚àà STUDENTE: f_CAP(e) ‚àà Œ£‚Åµ</code>, <code>‚àÄ e: contieneChiocciola(f_Email(e))</code>.</li>
      </ul>
    </li>

    <li>
      <strong>Cardinalit√† del multivalore</strong>:
      <ul>
        <li>Specifica <em>min/max</em>: es. <code>Telefono</code> ha <code>0..*</code> (facoltativo) oppure <code>1..3</code> (almeno uno, al massimo tre).</li>
        <li><em>Unicit√† interna</em>: valori distinti all‚Äôinterno dello stesso insieme (<code>‚àÄ e: |f_Tel(e)| = |set(f_Tel(e))|</code>).</li>
        <li><em>Assenza di ordine</em>: l‚Äôinsieme non √® una lista; se serve un ordinamento o una priorit√†, introduce un attributo aggiuntivo (es. <code>Priorit√† ‚àà {primario, secondario}</code>).</li>
        <li>Se i valori hanno propriet√† proprie (tipo, note, validit√†), <em>promuovili</em> a nuova entit√† (<code>EmailDocente</code>) collegata 1:N.</li>
      </ul>
    </li>

    <li>
      <strong>Derivati</strong>:
      <ul>
        <li>Un derivato √® determinato dagli altri dati: <code>f_D(e) = g(f_1(e), ‚Ä¶)</code>. In generale <em>non si memorizza</em>.</li>
        <li>Se dipende dal tempo (es. <code>Et√†</code>), memorizzarlo genera inconsistenze; calcolarlo al volo o tramite <em>vista</em>.</li>
        <li>Se si decide di materializzarlo (motivi di performance), definire:
          <ul>
            <li><em>Regola di aggiornamento</em> (quando/come ricalcolarlo).</li>
            <li><em>Fonte autorevole</em> (quali attributi lo determinano).</li>
            <li><em>Invarianze</em> (es. ‚ÄúEt√†‚Äù cambia ogni anno ‚Üí evitare materializzazione).</li>
          </ul>
        </li>
      </ul>
    </li>

    <li>
      <strong>Composti</strong>:
      <ul>
        <li>Un attributo composto (<code>Indirizzo = (Via, Citt√†, CAP)</code>) √® utile se i componenti hanno semantica/ricerca/vincoli propri.</li>
        <li>Esplicita i componenti come attributi semplici separati se:
          <ul>
            <li>servono <em>query mirate</em> (filtrare per CAP, ordinare per Citt√†),</li>
            <li>hanno <em>domini specifici</em> (CAP numerico a 5 cifre),</li>
            <li>richiedono <em>vincoli incrociati</em> (CAP compatibile con Citt√†/Provincia).</li>
          </ul>
        </li>
        <li>Evita ‚Äúblob testuali‚Äù (un solo campo libero) perch√© indeboliscono i vincoli e complicano le ricerche.</li>
        <li>Consenti <em>parzialit√† controllata</em> solo se ha senso (es. Via nota ma CAP sconosciuto), documentando quali componenti possono essere NULL e perch√©.</li>
      </ul>
    </li>
  </ul>

  <div style="margin-top:.6rem">
    <button id="btnVBP" onclick="toggleBox('btnVBP','ansVBP')">Esempi di specifiche rigorose ‚ñº</button>
  </div>
  <div id="ansVBP" style="display:none; margin-top:.5rem">
    <pre><code class="language-text">Esempio (STUDENTE)
Domini:
  CAP ‚àà Œ£‚Åµ con Œ£ = {0..9}
  Telefono ‚àà { "+"? ¬∑ [0-9]{6..15} } normalizzato togliendo spazi e '-'
  Email soddisfa: contieneChiocciola(email) ‚àß nonIniziaConChiocciola(email) ‚àß nonFinisceConChiocciola(email)

Vincoli:
  ‚àÄ e: |Telefono(e)| ‚â§ 3              -- al pi√π tre numeri
  ‚àÄ e: |Telefono(e)| = |set(Telefono(e))|  -- tutti distinti
  ‚àÄ e: Et√†(e) = oggi ‚àí DataNascita(e)       -- derivato, non memorizzato
  ‚àÄ e: CAP(e) ‚áî (len=5 ‚àß cifre)             -- dominio forte su CAP
</code></pre>
  </div>
</div>


        <h2>Implicazioni per la traduzione (preview Lez2.7)</h2>
        <div class="box">
          <ul>
            <li><strong>Composti ‚Üí</strong> diventano pi√π colonne nell‚Äôentit√† corrispondente (Via, Citt√†, CAP).</li>
            <li><strong>Multivalore ‚Üí</strong> nuova entit√† e relazione 1:N (o tabella associativa) <em>TelefonoDi(Studente, Tel)</em>.</li>
            <li><strong>Derivati ‚Üí</strong> non si materializzano; si calcolano nelle query o come vista.</li>
          </ul>
          <div class="note">Le regole precise sono nella Lez2.7 (trasformazione E-R ‚Üí relazionale).</div>
        </div>

        <h2>Errori comuni</h2>
        <div class="box">
          <ul>
            <li><span class="warn">Salvare Et√†</span> invece di DataNascita ‚Üí incoerenze nel tempo.</li>
            <li><span class="warn">Lista CSV</span> di telefoni in un‚Äôunica cella ‚Üí perde semantica di insieme, impossibile vincolare/ricercare bene.</li>
            <li><span class="warn">Indirizzo ‚Äúblob‚Äù</span> non scomponibile ‚Üí query e vincoli pi√π deboli.</li>
          </ul>
        </div>

        <h2>Domanda-guida</h2>
        <div class="box">
          <p><strong>Quando conviene trasformare un attributo multivalore in una nuova entit√†?</strong></p>
          <button id="btnDG25" onclick="toggleBox('btnDG25','ansDG25')">Mostra ‚ñº</button>
          <div id="ansDG25" style="display:none; margin-top:.5rem">
            <ul>
              <li>Quando serve <strong>ricercare</strong> o <strong>vincolare</strong> i singoli valori (unicit√†, formato, frequenza).</li>
              <li>Quando i valori hanno <strong>propriet√† proprie</strong> (es. TipoTelefono, Note, Priorit√†).</li>
              <li>Quando la <strong>cardinalit√†</strong> √® variabile e potenzialmente grande.</li>
            </ul>
          </div>
        </div>

        <h2>Esercizio rapido</h2>
        <div class="box">
          <p><strong>Scenario</strong>: nell‚Äôentit√† <code>DOCENTE</code> abbiamo <em>Email*</em> (multivalore), <em>Ufficio</em> (composto: Edificio, Piano, Stanza), e <em>Anzianit√†</em> (derivato da DataAssunzione).</p>
          <button id="btnEX25" onclick="toggleBox('btnEX25','ansEX25')">Mostra soluzione ‚ñº</button>
          <div id="ansEX25" style="display:none; margin-top:.5rem">
            <ul>
              <li><strong>Email*</strong> ‚Üí nuova entit√† <em>EmailDocente</em> con relazione 1:N; vincolo di formato e unicit√† per docente.</li>
              <li><strong>Ufficio</strong> ‚Üí scomporre in tre attributi (Edificio, Piano, Stanza); opzionalmente vincoli su dominio (range Piano, pattern Stanza).</li>
              <li><strong>Anzianit√†</strong> ‚Üí non memorizzare; calcolare come differenza tra data corrente e <em>DataAssunzione</em>.</li>
            </ul>
          </div>
        </div>

      </div>
    </div>

    <div class="nav-buttons" style="margin-top:10px">
      <button onclick="prevSlide()">&#8592; Indietro</button>
      <button onclick="nextSlide()">Avanti &#8594;</button>
    </div>
  </div>
</body>
</html>
